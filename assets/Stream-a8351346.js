import{a as W,E as J,r as d,k as M,c as o,d as a,e as s,F as z,m as B,n as Z,t as u,j as G,g as D,v as j,h as v,z as ts,C as os,i as as,o as ss,l as ls,I as H,f as es,p as rs}from"./index-ae66ec3f.js";import{_ as ns}from"./AttachmentPreview-1fd7681c.js";const cs={class:"bg-white rounded-classroom classroom-shadow p-4"},is={class:"flex items-start space-x-3 mb-4"},ds=["src","alt"],us={key:0,class:"space-y-4"},ms={class:"flex items-center space-x-2 border-b border-classroom-gray-100 pb-3"},ps=["onClick"],vs={class:"material-icons text-base mr-1"},ys={key:0,class:"space-y-2"},xs={class:"space-y-2"},fs={class:"space-y-2"},gs={class:"border-2 border-dashed border-classroom-gray-300 rounded-classroom p-4 text-center"},hs={key:0,class:"space-y-2"},bs={class:"flex items-center space-x-3"},ws={class:"text-sm font-medium text-classroom-gray-900"},ks={class:"text-xs text-classroom-gray-500"},Cs=["onClick"],_s={class:"space-y-2"},$s={class:"space-y-2"},Ps={class:"flex flex-wrap gap-2"},Ts=["onClick"],As={class:"flex items-center justify-between"},Ss={class:"flex items-center space-x-2 cursor-pointer"},Us={key:0,class:"flex items-center space-x-2"},Is={class:"flex items-center justify-end space-x-3 pt-4 border-t border-classroom-gray-100"},Ms=["disabled"],Es={__name:"StreamComposer",props:{courseId:{type:String,required:!0}},emits:["post-created"],setup(c,{emit:F}){const x=c,V=F,$=W(),P=J(),m=d(!1),f=d("announcement"),i=d(""),y=d(""),w=d([]),U=d("all"),k=d([]),C=d(""),_=d(!1),T=d(""),g=d(""),p=M(()=>$.currentUser),h=[{value:"announcement",label:"Announcement",icon:"campaign"},{value:"question",label:"Question",icon:"help_outline"},{value:"material",label:"Material",icon:"description"},{value:"assignment",label:"Assignment",icon:"assignment"}],A=M(()=>!(f.value!=="material"&&!i.value.trim()||!y.value.trim())),R=()=>{m.value=!m.value},K=()=>{m.value=!1,N()},N=()=>{i.value="",y.value="",w.value=[],U.value="all",k.value=[],C.value="",_.value=!1,T.value="",g.value=""},Y=r=>{Array.from(r.target.files).forEach(b=>{w.value.push({name:b.name,size:l(b.size),type:b.type,file:b})}),r.target.value=""},O=r=>{w.value.splice(r,1)},S=()=>{C.value.trim()&&!k.value.includes(C.value.trim())&&(k.value.push(C.value.trim()),C.value="")},n=r=>{k.value=k.value.filter(e=>e!==r)},l=r=>{if(r===0)return"0 Bytes";const e=1024,b=["Bytes","KB","MB","GB"],E=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,E)).toFixed(2))+" "+b[E]},q=async()=>{if(!A.value)return;const r={courseId:x.courseId,authorId:p.value.id,type:f.value,title:i.value.trim(),content:y.value.trim(),attachments:w.value.map(e=>({name:e.name,type:e.type,size:e.size,url:"#"})),topics:k.value,audience:U.value,scheduled:_.value,scheduledAt:_.value?`${T.value}T${g.value}`:null};try{const e=await P.createPost(r);V("post-created",e),I("Post created successfully"),N(),m.value=!1}catch(e){console.error("Error creating post:",e),I("Error creating post")}},I=r=>{window.showToast&&window.showToast(r)};return(r,e)=>{var b,E;return o(),a("div",cs,[s("div",is,[s("img",{src:(b=p.value)==null?void 0:b.avatar,alt:(E=p.value)==null?void 0:E.name,class:"w-10 h-10 rounded-full"},null,8,ds),s("div",{class:"flex-1"},[s("button",{onClick:R,class:"w-full text-left p-3 border border-classroom-gray-300 rounded-classroom hover:border-classroom-gray-400 transition-colors text-classroom-gray-500 focus-classroom"}," Share something with your class... ")])]),m.value?(o(),a("div",us,[s("div",ms,[(o(),a(z,null,B(h,t=>s("button",{key:t.value,onClick:L=>f.value=t.value,class:Z(["px-3 py-2 rounded-classroom text-sm font-medium transition-colors",{"bg-classroom-primary bg-opacity-10 text-classroom-primary":f.value===t.value,"text-classroom-gray-600 hover:bg-classroom-gray-100":f.value!==t.value}])},[s("span",vs,u(t.icon),1),G(" "+u(t.label),1)],10,ps)),64))]),f.value!=="material"?(o(),a("div",ys,[e[8]||(e[8]=s("label",{class:"text-sm font-medium text-classroom-gray-700"},"Title",-1)),D(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),type:"text",placeholder:"Add a title...",class:"w-full px-3 py-2 border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors"},null,512),[[j,i.value]])])):v("",!0),s("div",xs,[e[9]||(e[9]=s("label",{class:"text-sm font-medium text-classroom-gray-700"},"Content",-1)),D(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),rows:"4",placeholder:"What do you want to share with your class?",class:"w-full px-3 py-2 border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors resize-none"},null,512),[[j,y.value]])]),s("div",fs,[e[14]||(e[14]=s("label",{class:"text-sm font-medium text-classroom-gray-700"},"Attachments",-1)),s("div",gs,[s("input",{type:"file",ref:"fileInput",multiple:"",onChange:Y,class:"hidden"},null,544),s("button",{onClick:e[2]||(e[2]=t=>r.$refs.fileInput.click()),class:"btn-outline mb-2"},[...e[10]||(e[10]=[s("span",{class:"material-icons text-lg mr-2"},"attach_file",-1),G(" Add attachment ",-1)])]),e[11]||(e[11]=s("p",{class:"text-xs text-classroom-gray-500"},"You can attach files from your computer",-1))]),w.value.length>0?(o(),a("div",hs,[(o(!0),a(z,null,B(w.value,(t,L)=>(o(),a("div",{key:L,class:"flex items-center justify-between p-2 bg-classroom-gray-50 rounded-classroom"},[s("div",bs,[e[12]||(e[12]=s("span",{class:"material-icons text-classroom-gray-500"},"description",-1)),s("div",null,[s("p",ws,u(t.name),1),s("p",ks,u(t.size),1)])]),s("button",{onClick:Q=>O(L),class:"p-1 rounded-full hover:bg-classroom-gray-200 transition-colors"},[...e[13]||(e[13]=[s("span",{class:"material-icons text-classroom-gray-500 text-lg"},"close",-1)])],8,Cs)]))),128))])):v("",!0)]),s("div",_s,[e[16]||(e[16]=s("label",{class:"text-sm font-medium text-classroom-gray-700"},"Audience",-1)),D(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>U.value=t),class:"w-full px-3 py-2 border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors"},[...e[15]||(e[15]=[s("option",{value:"all"},"All students",-1),s("option",{value:"teachers"},"Teachers only",-1),s("option",{value:"specific"},"Specific students",-1)])],512),[[ts,U.value]])]),s("div",$s,[e[18]||(e[18]=s("label",{class:"text-sm font-medium text-classroom-gray-700"},"Topics",-1)),s("div",Ps,[(o(!0),a(z,null,B(k.value,t=>(o(),a("span",{key:t,class:"chip chip-primary flex items-center space-x-1"},[s("span",null,u(t),1),s("button",{onClick:L=>n(t),class:"hover:opacity-70"},[...e[17]||(e[17]=[s("span",{class:"material-icons text-xs"},"close",-1)])],8,Ts)]))),128)),D(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>C.value=t),onKeydown:os(S,["enter"]),placeholder:"Add a topic...",class:"flex-1 min-w-0 px-2 py-1 text-sm border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors"},null,544),[[j,C.value]])])]),s("div",As,[s("label",Ss,[D(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),type:"checkbox",class:"rounded border-classroom-gray-300 text-classroom-primary focus:ring-classroom-primary"},null,512),[[as,_.value]]),e[19]||(e[19]=s("span",{class:"text-sm text-classroom-gray-700"},"Schedule post",-1))]),_.value?(o(),a("div",Us,[D(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>T.value=t),type:"date",class:"px-2 py-1 border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors text-sm"},null,512),[[j,T.value]]),D(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>g.value=t),type:"time",class:"px-2 py-1 border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors text-sm"},null,512),[[j,g.value]])])):v("",!0)]),s("div",Is,[s("button",{onClick:K,class:"btn-outline"}," Cancel "),s("button",{onClick:q,disabled:!A.value,class:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed"}," Post ",8,Ms)])])):v("",!0)])}}},Ds={class:"bg-white rounded-classroom classroom-shadow p-4"},zs={class:"flex items-start justify-between mb-4"},Bs={class:"flex items-start space-x-3"},Vs=["src","alt"],Ls={class:"flex items-center space-x-2"},js={class:"font-medium text-classroom-gray-900"},Fs={class:"text-sm text-classroom-gray-500"},qs={class:"relative"},Ns={key:0,class:"absolute right-0 top-full mt-1 bg-white rounded-classroom classroom-shadow-lg border border-classroom-gray-200 py-1 z-10 w-48"},Os={key:0,class:"text-lg font-medium text-classroom-gray-900 mb-3"},Rs={class:"text-classroom-gray-700 mb-4 whitespace-pre-line"},Ks={key:1,class:"mb-4"},Ys={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Qs={key:2,class:"flex flex-wrap gap-2 mb-4"},Gs={class:"flex items-center justify-between pt-4 border-t border-classroom-gray-100"},Hs={class:"flex items-center space-x-4"},Ws={class:"text-sm"},Js={key:3,class:"mt-4 pt-4 border-t border-classroom-gray-100"},Xs={key:0,class:"space-y-3 mb-4"},Zs=["src","alt"],se={class:"flex-1"},ee={class:"bg-classroom-gray-50 rounded-classroom p-3"},te={class:"flex items-center space-x-2 mb-1"},oe={class:"text-sm font-medium text-classroom-gray-900"},ae={class:"text-xs text-classroom-gray-500"},le={class:"text-sm text-classroom-gray-700"},re={class:"flex items-start space-x-3"},ne=["src","alt"],ce={class:"flex-1"},ie={class:"flex items-center justify-end space-x-2 mt-2"},de=["disabled"],ue={__name:"PostItem",props:{post:{type:Object,required:!0}},emits:["post-updated","post-deleted","comment-added"],setup(c,{emit:F}){const x=c,V=F,$=W(),P=J(),m=d(!1),f=d(!1),i=d(""),y=M(()=>$.currentUser),w=M(()=>$.getUserById(x.post.authorId)),U=M(()=>{var n;return((n=y.value)==null?void 0:n.id)===x.post.authorId||$.isTeacher}),k=n=>({announcement:"chip-primary",question:"chip-secondary",material:"chip-gray",assignment:"chip-primary"})[n]||"chip-gray",C=n=>({announcement:"Announcement",question:"Question",material:"Material",assignment:"Assignment"})[n]||"Post",_=n=>{const l=new Date(n),I=new Date().getTime()-l.getTime(),r=Math.floor(I/(1e3*60*60*24));if(r===0){const e=Math.floor(I/36e5);return e===0?`${Math.floor(I/6e4)}m ago`:`${e}h ago`}return r===1?"Yesterday":r<7?`${r}d ago`:l.toLocaleDateString()},T=n=>$.getUserById(n),g=()=>{m.value=!m.value},p=()=>{f.value=!f.value},h=()=>{S("Edit post functionality would open here"),m.value=!1},A=()=>{navigator.clipboard.writeText(`${x.post.title}

${x.post.content}`).then(()=>{S("Post copied to clipboard"),m.value=!1}).catch(()=>{S("Failed to copy post")})},R=()=>{S("Reuse post functionality would open here"),m.value=!1},K=async()=>{if(confirm("Are you sure you want to delete this post?"))try{await P.deletePost(x.post.id),V("post-deleted",x.post.id),S("Post deleted successfully")}catch(n){console.error("Error deleting post:",n),S("Error deleting post")}m.value=!1},N=async()=>{if(!i.value.trim())return;const n={authorId:y.value.id,content:i.value.trim()};try{await P.addComment(x.post.id,n),V("comment-added",x.post.id,n),i.value="",S("Comment added successfully")}catch(l){console.error("Error adding comment:",l),S("Error adding comment")}},Y=()=>{i.value=""},O=n=>{!n.target.closest(".relative")&&!n.target.closest('button[aria-label="Post options"]')&&(m.value=!1)};ss(()=>{document.addEventListener("click",O)}),ls(()=>{document.removeEventListener("click",O)});const S=n=>{window.showToast&&window.showToast(n)};return(n,l)=>{var q,I,r,e,b,E;return o(),a("div",Ds,[s("div",zs,[s("div",Bs,[s("img",{src:(q=w.value)==null?void 0:q.avatar,alt:(I=w.value)==null?void 0:I.name,class:"w-10 h-10 rounded-full"},null,8,Vs),s("div",null,[s("div",Ls,[s("h3",js,u((r=w.value)==null?void 0:r.name),1),s("span",{class:Z(["chip text-xs",k(c.post.type)])},u(C(c.post.type)),3)]),s("p",Fs,u(_(c.post.createdAt)),1)])]),s("div",qs,[s("button",{onClick:g,class:"p-1 rounded-full hover:bg-classroom-gray-100 transition-colors focus-classroom","aria-label":"Post options"},[...l[1]||(l[1]=[s("span",{class:"material-icons text-classroom-gray-600 text-lg"},"more_vert",-1)])]),m.value?(o(),a("div",Ns,[U.value?(o(),a("button",{key:0,onClick:h,class:"w-full text-left px-4 py-2 hover:bg-classroom-gray-100 text-sm flex items-center space-x-2"},[...l[2]||(l[2]=[s("span",{class:"material-icons text-classroom-gray-600 text-lg"},"edit",-1),s("span",null,"Edit",-1)])])):v("",!0),s("button",{onClick:A,class:"w-full text-left px-4 py-2 hover:bg-classroom-gray-100 text-sm flex items-center space-x-2"},[...l[3]||(l[3]=[s("span",{class:"material-icons text-classroom-gray-600 text-lg"},"content_copy",-1),s("span",null,"Copy",-1)])]),s("button",{onClick:R,class:"w-full text-left px-4 py-2 hover:bg-classroom-gray-100 text-sm flex items-center space-x-2"},[...l[4]||(l[4]=[s("span",{class:"material-icons text-classroom-gray-600 text-lg"},"replay",-1),s("span",null,"Reuse post",-1)])]),l[6]||(l[6]=s("div",{class:"border-t border-classroom-gray-100 my-1"},null,-1)),U.value?(o(),a("button",{key:1,onClick:K,class:"w-full text-left px-4 py-2 hover:bg-classroom-gray-100 text-sm flex items-center space-x-2 text-red-600"},[...l[5]||(l[5]=[s("span",{class:"material-icons text-lg"},"delete",-1),s("span",null,"Delete",-1)])])):v("",!0)])):v("",!0)])]),c.post.title?(o(),a("h4",Os,u(c.post.title),1)):v("",!0),s("div",Rs,u(c.post.content),1),c.post.attachments&&c.post.attachments.length>0?(o(),a("div",Ks,[s("div",Ys,[(o(!0),a(z,null,B(c.post.attachments,t=>(o(),H(ns,{key:t.name,attachment:t},null,8,["attachment"]))),128))])])):v("",!0),c.post.topics&&c.post.topics.length>0?(o(),a("div",Qs,[(o(!0),a(z,null,B(c.post.topics,t=>(o(),a("span",{key:t,class:"chip chip-gray text-xs"},u(t),1))),128))])):v("",!0),s("div",Gs,[s("div",Hs,[s("button",{onClick:p,class:"flex items-center space-x-1 text-classroom-gray-600 hover:text-classroom-gray-800 transition-colors"},[l[7]||(l[7]=s("span",{class:"material-icons text-lg"},"chat_bubble_outline",-1)),s("span",Ws,u(((e=c.post.comments)==null?void 0:e.length)||0),1)]),l[8]||(l[8]=es('<button class="flex items-center space-x-1 text-classroom-gray-600 hover:text-classroom-gray-800 transition-colors"><span class="material-icons text-lg">thumb_up</span><span class="text-sm">Like</span></button><button class="flex items-center space-x-1 text-classroom-gray-600 hover:text-classroom-gray-800 transition-colors"><span class="material-icons text-lg">share</span><span class="text-sm">Share</span></button>',2))])]),f.value?(o(),a("div",Js,[c.post.comments&&c.post.comments.length>0?(o(),a("div",Xs,[(o(!0),a(z,null,B(c.post.comments,t=>{var L,Q,X;return o(),a("div",{key:t.id,class:"flex items-start space-x-3"},[s("img",{src:(L=T(t.authorId))==null?void 0:L.avatar,alt:(Q=T(t.authorId))==null?void 0:Q.name,class:"w-8 h-8 rounded-full"},null,8,Zs),s("div",se,[s("div",ee,[s("div",te,[s("span",oe,u((X=T(t.authorId))==null?void 0:X.name),1),s("span",ae,u(_(t.createdAt)),1)]),s("p",le,u(t.content),1)]),l[9]||(l[9]=s("div",{class:"flex items-center space-x-3 mt-1 ml-3"},[s("button",{class:"text-xs text-classroom-gray-500 hover:text-classroom-gray-700"}," Like "),s("button",{class:"text-xs text-classroom-gray-500 hover:text-classroom-gray-700"}," Reply ")],-1))])])}),128))])):v("",!0),s("div",re,[s("img",{src:(b=y.value)==null?void 0:b.avatar,alt:(E=y.value)==null?void 0:E.name,class:"w-8 h-8 rounded-full"},null,8,ne),s("div",ce,[D(s("textarea",{"onUpdate:modelValue":l[0]||(l[0]=t=>i.value=t),rows:"2",placeholder:"Add a class comment...",class:"w-full px-3 py-2 border border-classroom-gray-300 rounded-classroom focus:border-classroom-primary focus:outline-none transition-colors resize-none text-sm"},null,512),[[j,i.value]]),s("div",ie,[s("button",{onClick:Y,class:"btn-outline text-sm px-3 py-1"}," Cancel "),s("button",{onClick:N,disabled:!i.value.trim(),class:"btn-primary text-sm px-3 py-1 disabled:opacity-50 disabled:cursor-not-allowed"}," Comment ",8,de)])])])])):v("",!0)])}}},me={class:"space-y-6"},pe={key:1,class:"space-y-4"},ve={key:2,class:"bg-white rounded-classroom classroom-shadow p-8 text-center"},ye={class:"text-classroom-gray-600 mb-4"},xe={key:3,class:"space-y-4"},fe={key:4,class:"text-center"},ge=["disabled"],he={key:0,class:"material-icons animate-spin text-lg mr-2"},ke={__name:"Stream",setup(c){const F=rs(),x=W(),V=J(),$=d(!1),P=d(!1),m=d(!1),f=M(()=>F.params.id);M(()=>x.currentUser);const i=M(()=>x.isTeacher),y=M(()=>V.getPostsByCourse(f.value)),w=p=>{g("Post created successfully")},U=p=>{g("Post updated successfully")},k=p=>{g("Post deleted successfully")},C=(p,h)=>{g("Comment added")},_=async()=>{P.value=!0,await new Promise(p=>setTimeout(p,1e3)),P.value=!1,g("No more posts to load")},T=async()=>{$.value=!0;try{await V.loadPosts()}catch(p){console.error("Error loading posts:",p),g("Error loading posts")}finally{$.value=!1}};ss(()=>{T()});const g=p=>{window.showToast&&window.showToast(p)};return(p,h)=>(o(),a("div",me,[i.value?(o(),H(Es,{key:0,"course-id":f.value,onPostCreated:w},null,8,["course-id"])):v("",!0),$.value?(o(),a("div",pe,[(o(),a(z,null,B(3,A=>s("div",{key:A,class:"bg-white rounded-classroom classroom-shadow p-4"},[...h[1]||(h[1]=[es('<div class="flex items-start space-x-3 mb-4"><div class="skeleton w-10 h-10 rounded-full"></div><div class="flex-1"><div class="skeleton h-4 w-32 mb-2"></div><div class="skeleton h-3 w-24"></div></div></div><div class="skeleton h-4 w-full mb-2"></div><div class="skeleton h-4 w-3/4"></div>',3)])])),64))])):y.value.length===0?(o(),a("div",ve,[h[2]||(h[2]=s("div",{class:"w-16 h-16 bg-classroom-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[s("span",{class:"material-icons text-classroom-gray-400 text-2xl"},"chat")],-1)),h[3]||(h[3]=s("h3",{class:"text-lg font-medium text-classroom-gray-900 mb-2"},"No posts yet",-1)),s("p",ye,u(i.value?"Share announcements, assignments, or questions with your class.":"Your teacher hasn't posted anything yet."),1),i.value?(o(),a("button",{key:0,onClick:h[0]||(h[0]=A=>m.value=!0),class:"btn-primary"}," Create your first post ")):v("",!0)])):(o(),a("div",xe,[(o(!0),a(z,null,B(y.value,A=>(o(),H(ue,{key:A.id,post:A,onPostUpdated:U,onPostDeleted:k,onCommentAdded:C},null,8,["post"]))),128))])),y.value.length>0?(o(),a("div",fe,[s("button",{onClick:_,class:"btn-outline",disabled:P.value},[P.value?(o(),a("span",he,"refresh")):v("",!0),G(" "+u(P.value?"Loading...":"Load more posts"),1)],8,ge)])):v("",!0)]))}};export{ke as default};
