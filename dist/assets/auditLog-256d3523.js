import{L as n}from"./index-d2bf20c5.js";import{u as a}from"./auth-17017921.js";const c=n("auditLog",{state:()=>({logs:JSON.parse(localStorage.getItem("mock:auditLogs")||"[]")}),actions:{logAction(t,e={}){const s=a().user,i={id:Date.now()+Math.random(),timestamp:new Date().toISOString(),userId:s==null?void 0:s.id,userName:s==null?void 0:s.name,userEmail:s==null?void 0:s.email,userRole:s==null?void 0:s.role,action:t,details:e,ipAddress:"127.0.0.1",userAgent:navigator.userAgent};return this.logs.unshift(i),this.logs.length>1e3&&(this.logs=this.logs.slice(0,1e3)),this.saveLogs(),i},logUserCreated(t){return this.logAction("USER_CREATED",{userId:t.id,userName:t.name,userEmail:t.email,userRole:t.role})},logUserUpdated(t,e){return this.logAction("USER_UPDATED",{userId:t,changes:e})},logUserDeleted(t,e){return this.logAction("USER_DELETED",{userId:t,userName:e})},logClassCreated(t){return this.logAction("CLASS_CREATED",{classId:t.id,className:t.name})},logClassUpdated(t,e){return this.logAction("CLASS_UPDATED",{classId:t,changes:e})},logClassDeleted(t,e){return this.logAction("CLASS_DELETED",{classId:t,className:e})},logBulkOperation(t,e,o){return this.logAction("BULK_OPERATION",{operationType:t,count:e,...o})},logSystemSettingsChanged(t){return this.logAction("SYSTEM_SETTINGS_CHANGED",{settings:t})},logBackupCreated(t){return this.logAction("BACKUP_CREATED",{backupId:t})},logBackupRestored(t){return this.logAction("BACKUP_RESTORED",{backupId:t})},logDataExport(t,e){return this.logAction("DATA_EXPORTED",{exportType:t,recordCount:e})},logDataImport(t,e,o){return this.logAction("DATA_IMPORTED",{importType:t,recordCount:e,status:o})},logLogin(t=!0){return this.logAction(t?"LOGIN_SUCCESS":"LOGIN_FAILED",{timestamp:new Date().toISOString()})},logLogout(){return this.logAction("LOGOUT",{timestamp:new Date().toISOString()})},logPermissionChanged(t,e,o){return this.logAction("PERMISSION_CHANGED",{userId:t,oldPermissions:e,newPermissions:o})},async fetchLogs(t={}){await new Promise(o=>setTimeout(o,300));let e=[...this.logs];if(t.action&&(e=e.filter(o=>o.action===t.action)),t.userId&&(e=e.filter(o=>o.userId===t.userId)),t.startDate&&(e=e.filter(o=>new Date(o.timestamp)>=new Date(t.startDate))),t.endDate&&(e=e.filter(o=>new Date(o.timestamp)<=new Date(t.endDate))),t.search){const o=t.search.toLowerCase();e=e.filter(s=>{var i,r;return s.action.toLowerCase().includes(o)||((i=s.userName)==null?void 0:i.toLowerCase().includes(o))||((r=s.userEmail)==null?void 0:r.toLowerCase().includes(o))||JSON.stringify(s.details).toLowerCase().includes(o)})}return e},saveLogs(){localStorage.setItem("mock:auditLogs",JSON.stringify(this.logs))},clearOldLogs(t=90){const e=new Date;e.setDate(e.getDate()-t),this.logs=this.logs.filter(o=>new Date(o.timestamp)>=e),this.saveLogs()},exportLogs(t="json"){if(t==="json")return JSON.stringify(this.logs,null,2);if(t==="csv"){const e=["Timestamp","User","Email","Role","Action","Details"],o=this.logs.map(i=>[i.timestamp,i.userName,i.userEmail,i.userRole,i.action,JSON.stringify(i.details)]);return[e.join(","),...o.map(i=>i.map(r=>`"${r}"`).join(","))].join(`
`)}}},getters:{recentLogs:t=>t.logs.slice(0,50),logsByAction:t=>e=>t.logs.filter(o=>o.action===e),logsByUser:t=>e=>t.logs.filter(o=>o.userId===e),logsByDateRange:t=>(e,o)=>t.logs.filter(s=>{const i=new Date(s.timestamp);return i>=new Date(e)&&i<=new Date(o)}),actionSummary:t=>{const e={};return t.logs.forEach(o=>{e[o.action]=(e[o.action]||0)+1}),e}}});export{c as u};
